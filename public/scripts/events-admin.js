"use strict";function renderEventsTable(){knucklebone.getJson("/get/events").success(function(e){dom("events-table-cont").purge();var t=document.createDocumentFragment();e.forEach(function(e){t.appendChild(createTableItem(e))}),dom("events-table-cont").append(t)}).error(function(){dom("events-table-cont").purge().append(createTableItem({name:"BYU Hack Night",place:"484 Tanner Building",time:"Thursdays 7-10pm",description:"Hack with others"}))})}function createTableItem(e){e.date=e.date.replace(/-/g,"/");var t=dom.create("div").addClass("table-cont"),n=getDay(e.date),r=new Date(e.date).getDate(),a=getMonth(e.date);e.date=e.date||"",e.time=e.time||"";var o=dom.create("table").addClass("event-table").append(dom.create("tr").addClass("event-info").append(dom.create("td").addClass("event-name").text(e.name),dom.create("td").addClass("event-place").text(e.place),dom.create("td").addClass("event-time").text(n+", "+a+" "+r+". "+e.time)),dom.create("tr").addClass("event-description").append(dom.create("td").addClass("event-description").attr("colspan",3).text(e.description)));return t.append(dom.create("div").addClass("delete-event").text("x").attr("data-id",e.id).listen("click",function(){"function"==typeof deleteEvent&&deleteEvent(this.dataset.id)})),t.append(o)}function getDay(e){var t=new Date(e).getDay(),n={0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thur",5:"Fri",6:"Sat"};return n[t]}function getMonth(e){var t=new Date(e).getMonth(),n={0:"Jan",1:"Feb",2:"Mar",3:"Apr",4:"May",5:"Jun",6:"Jul",7:"Aug",8:"Sep",9:"Oct",10:"Nov",11:"Dec"};return n[t]}function postEventsArray(e){knucklebone.postJson("/post/events",e).success(function(){renderEventsTable()}).error(function(e){alert("Error:"+e)})}function deleteEvent(e){knucklebone.getJson("/get/events").success(function(t){var n=t.filter(function(t){return t.id!==e});postEventsArray(n)}).error(function(e){alert("Error:"+e)})}function createNewEvent(){var e=knucklebone.formToObject("new-event-form");return e.id=rand(12,"special"),e}var newEventForm=dom("new-event-form"),inputFields=dom.queryByClass("input-field").toArr();newEventForm.listen("submit",function(e){e.preventDefault();var t=!1,n="mm/dd/yyyy";inputFields.forEach(function(e){if(e.value.trim().length<=0&&(e.classList.add("error"),t=!0),"date"===e.getAttribute("name")){var r=e.value,a=r.split("/");if(console.log("arr",a),a.length<3)return t=!0,e.classList.add("error"),void alert("1 date format is: "+n);if(2!==a[0].length)return t=!0,e.classList.add("error"),void alert("2 date format is: "+n);if(2!==a[1].length)return t=!0,e.classList.add("error"),void alert("3 date format is: "+n);if(4!==parseInt(a[2]).toString().length)return t=!0,e.classList.add("error"),void alert("4 date format is: "+n)}}),t||!function(){var e=createNewEvent();knucklebone.getJson("/get/events").success(function(t){e.date=e.date.replace(/-/g,"/"),t.push(e),postEventsArray(t)}).error(function(e){alert("Error:"+e)})}()}),inputFields.forEach(function(e){e.addEventListener("focus",function(){this.classList.remove("error")})}),window.addEventListener("load",function(){return renderEventsTable()});
